<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#1E2749" />
    <title>জাপানি ফ্ল্যাশকার্ড প্র্যাকটিস</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --bg-start: #1e2749;
            --bg-end: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --ink: #f1f5f9;
            --muted: #94a3b8;
            --accent: #6d28d9;
            --accent-light: #8b5cf6;
            --accent-glow: #a78bfa;
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            --transition: 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --border-radius: 20px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Hind Siliguri', sans-serif;
            background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
            color: var(--ink);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        body::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top, var(--accent), transparent 60%);
            opacity: 0.15;
            z-index: -1;
        }

        .container {
            width: 100%;
            height: 100%;
            max-width: 1280px;
            max-height: 720px;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            border-radius: var(--border-radius);
            backdrop-filter: blur(12px);
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            position: relative;
        }

        .header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
        }

        .app-title {
            font-family: 'Hind Siliguri', sans-serif;
            font-size: clamp(1.5rem, 4vw, 3rem);
            font-weight: 700;
            text-align: left;
            text-shadow: 0 0 10px var(--accent-glow);
            letter-spacing: 1px;
        }

        .highlight {
            color: var(--accent-light);
        }

        .audio-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .play-pause-btn {
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 15px var(--accent-glow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .play-pause-btn:hover { transform: scale(1.1); }
        .play-pause-btn:active { transform: scale(0.95); }

        .volume-control {
            width: 120px;
            accent-color: var(--accent-light);
        }

        .main-card {
            flex-grow: 1;
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            padding: 2rem;
            border-radius: var(--border-radius);
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .timer-container {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 70px;
            height: 70px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .timer-container.visible { opacity: 1; }

        .timer-circle {
            width: 100%;
            height: 100%;
            position: relative;
        }
        .timer-svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        .timer-circle-bg {
            fill: none;
            stroke: var(--muted);
            stroke-width: 5;
        }
        .timer-circle-progress {
            fill: none;
            stroke: var(--accent-light);
            stroke-width: 5;
            stroke-linecap: round;
            stroke-dasharray: 188.5;
            stroke-dashoffset: 188.5;
            transition: stroke-dashoffset linear;
        }
        .timer-count {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 600;
            color: var(--ink);
        }

        .question, .answer, .pronunciation {
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 700;
            opacity: 0;
            transform: translateY(20px) scale(0.9);
            transition: var(--transition);
        }

        .question {
            font-size: clamp(2rem, 6vw, 4rem);
            min-height: 80px;
        }

        .answer {
            font-size: clamp(2.5rem, 8vw, 5rem);
            color: var(--accent-light);
            text-shadow: 0 0 15px var(--accent-glow);
        }

        .pronunciation {
            font-family: 'Hind Siliguri', sans-serif;
            font-weight: 400;
            font-size: clamp(1.2rem, 3vw, 2rem);
            color: var(--muted);
            margin-top: 10px;
        }

        .visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .progress-bar-container {
            width: 100%;
            height: 10px;
            background: var(--muted);
            border-radius: 5px;
            overflow: hidden;
            margin: 1.5rem 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #a78bfa, #8b5cf6);
            transition: width 0.5s ease;
        }

        .status-message {
            font-size: 1.2rem;
            font-weight: 500;
            text-align: center;
            color: var(--muted);
        }

        .footer {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 500;
            color: #fff;
            text-decoration: none;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            transition: background-color 0.3s ease;
        }
        .social-link:hover { background: rgba(255, 255, 255, 0.2); }

        .social-link.youtube { background-color: #ff0000; }
        .social-link.facebook { background-color: #1877f2; }

        .marquee-container {
            width: 100%;
            padding: 12px 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }
        .marquee-text {
            white-space: nowrap;
            animation: marquee 20s linear infinite;
            font-size: 1rem;
        }

        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* Responsive design adjustments */
        @media (max-width: 768px) {
            .container { padding: 1.5rem; }
            .header { flex-direction: column; align-items: center; text-align: center; gap: 1.5rem; }
            .app-title { text-align: center; }
            .audio-controls { margin-top: 1rem; }
            .main-card { padding: 1.5rem; }
            .question { font-size: 2.5rem; }
            .answer { font-size: 3rem; }
            .pronunciation { font-size: 1.5rem; }
            .social-links { flex-direction: column; gap: 1rem; }
            .social-link { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="app-title"><span class="highlight">N5</span> এর <span class="highlight">Lesson-1</span> এর ভোকাবুলারি প্র্যাকটিস</h1>
            <div class="audio-controls">
                <button id="play-pause-btn" class="play-pause-btn" aria-label="Play or pause background music">
                    <i class="fas fa-play"></i>
                </button>
                <input type="range" id="volume-control" class="volume-control" min="0" max="1" step="0.01" value="0.05">
            </div>
        </div>

        <main class="main-card">
            <div class="timer-container">
                <div class="timer-circle">
                    <svg class="timer-svg" viewBox="0 0 80 80">
                        <circle class="timer-circle-bg" cx="40" cy="40" r="34"></circle>
                        <circle class="timer-circle-progress" cx="40" cy="40" r="34"></circle>
                    </svg>
                    <div id="timer-count" class="timer-count"></div>
                </div>
            </div>
            <div id="q" class="question"></div>
            <div id="a" class="answer"></div>
            <div id="p" class="pronunciation"></div>
        </main>

        <div class="progress-bar-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        <p id="status-message" class="status-message">প্রস্তুত হচ্ছে...</p>

        <div class="footer">
            <div class="social-links">
                <a href="https://www.facebook.com/sdnrubel" class="social-link facebook" target="_blank">
                    <i class="fa-brands fa-facebook-f"></i>
                    <span>Facebook: sdnrubel</span>
                </a>
                <a href="https://www.youtube.com/@sdnrubel" class="social-link youtube" target="_blank">
                    <i class="fa-brands fa-youtube"></i>
                    <span>YouTube: @sdnrubel</span>
                </a>
            </div>
            <div class="marquee-container">
                <div class="marquee-text">
                    এই চ্যানেলের মাধ্যমে আপনার জাপানি ভাষা শিক্ষার অগ্রগতি যাচাই করুন! সাবস্ক্রাইব করুন, বন্ধুদের সাথে শেয়ার করুন এবং নতুন ভিডিওর জন্য নোটিফিকেশন চালু করুন।
                </div>
            </div>
        </div>
    </div>

    <audio id="background-music" src="https://raw.githubusercontent.com/sd-rubel/NihonGoBD/main/background_music.mp3" preload="auto" loop></audio>
    <audio id="beep-sound" src="https://raw.githubusercontent.com/sd-rubel/NihonGoBD/main/click.mp3" preload="auto"></audio>
    <audio id="result-sound" src="https://raw.githubusercontent.com/sd-rubel/NihonGoBD/main/success.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const backgroundMusic = document.getElementById('background-music');
            const beepSound = document.getElementById('beep-sound');
            const resultSound = document.getElementById('result-sound');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const volumeControl = document.getElementById('volume-control');
            let isMusicPlaying = false;

            const qEl = document.getElementById('q');
            const aEl = document.getElementById('a');
            const pEl = document.getElementById('p');
            const timerContainer = document.querySelector('.timer-container');
            const timerCount = document.getElementById('timer-count');
            const timerProgress = document.querySelector('.timer-circle-progress');
            const statusEl = document.getElementById('status-message');
            const progressBar = document.getElementById('progress-bar');
            
            let DATA = [];
            let currentIndex = -1;
            let timerInterval;
            const questionDuration = 7000;
            const totalPracticeTime = 3600; // 1 hour in seconds
            let practiceTimeLeft = totalPracticeTime;

            const audioSources = {
                background: 'https://raw.githubusercontent.com/sd-rubel/NihonGoBD/main/background_music.mp3',
                beep: 'https://raw.githubusercontent.com/sd-rubel/NihonGoBD/main/click.mp3',
                result: 'https://raw.githubusercontent.com/sd-rubel/NihonGoBD/main/success.mp3'
            };

            // Load audio files
            async function loadAudio() {
                try {
                    await Promise.all([
                        fetch(audioSources.background).then(res => res.blob()),
                        fetch(audioSources.beep).then(res => res.blob()),
                        fetch(audioSources.result).then(res => res.blob())
                    ]);
                    console.log('Audio files loaded successfully.');
                } catch (error) {
                    console.warn('Failed to pre-load audio files:', error);
                }
            }

            // Audio control
            volumeControl.addEventListener('input', () => {
                backgroundMusic.volume = parseFloat(volumeControl.value);
            });

            playPauseBtn.addEventListener('click', () => {
                if (isMusicPlaying) {
                    backgroundMusic.pause();
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                } else {
                    backgroundMusic.play().then(() => {
                        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    }).catch(e => {
                        console.error('Failed to play music:', e);
                        statusEl.textContent = 'মিউজিক প্লে করতে ব্যর্থ।';
                    });
                }
                isMusicPlaying = !isMusicPlaying;
            });

            // Handle initial audio play on mobile
            document.body.addEventListener('click', () => {
                if (!isMusicPlaying) {
                    backgroundMusic.volume = parseFloat(volumeControl.value);
                    backgroundMusic.play().then(() => {
                        isMusicPlaying = true;
                        playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    }).catch(() => {});
                }
            }, { once: true });

            // Load words from GitHub
            async function loadWords() {
                try {
                    statusEl.textContent = "শব্দ লোড হচ্ছে...";
                    const response = await fetch('https://raw.githubusercontent.com/sd-rubel/aaabbbir/refs/heads/main/words.json');
                    if (!response.ok) throw new Error('Failed to load words.json');
                    DATA = await response.json();
                    if (DATA.length === 0) throw new Error('Word list is empty.');
                    statusEl.textContent = "প্রস্তুত...";
                    startApp();
                } catch (error) {
                    console.error('Error:', error);
                    statusEl.textContent = "শব্দ লোড করতে ব্যর্থ। অনুগ্রহ করে ইন্টারনেট সংযোগ পরীক্ষা করুন।";
                }
            }

            // Japanese pronunciation with speechSynthesis
            function speak(text, callback) {
                if ('speechSynthesis' in window) {
                    const voices = speechSynthesis.getVoices();
                    const jpVoice = voices.find(voice => voice.lang === 'ja-JP');
                    if (jpVoice) {
                        const u = new SpeechSynthesisUtterance(text);
                        u.voice = jpVoice;
                        u.lang = 'ja-JP';
                        u.onend = () => { setTimeout(callback, 500); };
                        speechSynthesis.speak(u);
                    } else {
                        console.warn('Japanese speech synthesis voice not found. Skipping pronunciation.');
                        setTimeout(callback, 200);
                    }
                } else {
                    console.warn('Speech synthesis not supported. Skipping pronunciation.');
                    setTimeout(callback, 200);
                }
            }

            function startPracticeTimer() {
                setInterval(() => {
                    practiceTimeLeft--;
                    progressBar.style.width = `${((totalPracticeTime - practiceTimeLeft) / totalPracticeTime) * 100}%`;
                    if (practiceTimeLeft <= 0) {
                        practiceTimeLeft = totalPracticeTime;
                    }
                }, 1000);
            }

            function showNextCard() {
                if (DATA.length === 0) return;
                currentIndex = Math.floor(Math.random() * DATA.length);
                const item = DATA[currentIndex];
                
                // Reset card and animations
                qEl.textContent = item.bn_w;
                qEl.classList.remove("visible");
                aEl.classList.remove("visible");
                pEl.classList.remove("visible");
                
                // Animate in question
                setTimeout(() => {
                    qEl.classList.add("visible");
                    statusEl.textContent = "প্রশ্ন চলছে...";
                    timerContainer.classList.add("visible");
                    startQuestionTimer(item);
                }, 500);
            }

            function startQuestionTimer(item) {
                let timeLeft = questionDuration;
                const totalDashOffset = 2 * Math.PI * 34;
                timerProgress.style.strokeDashoffset = totalDashOffset;

                let lastFrameTime = performance.now();
                
                function updateTimer(currentTime) {
                    const elapsedTime = currentTime - lastFrameTime;
                    timeLeft -= elapsedTime;
                    lastFrameTime = currentTime;

                    if (timeLeft <= 0) {
                        timerContainer.classList.remove("visible");
                        showAnswer(item);
                        return;
                    }

                    const progress = (timeLeft / questionDuration) * totalDashOffset;
                    timerProgress.style.strokeDashoffset = progress;
                 